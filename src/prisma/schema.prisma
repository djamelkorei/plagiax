generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model accounts {
  id                  BigInt                @id @default(autoincrement()) @db.UnsignedBigInt
  email               String
  password            String
  status              accounts_status       @default(ACTIVE)
  type                accounts_type
  class_id            Int
  student_id          String
  student_firstname   String
  student_lastname    String
  created_at          DateTime?             @db.Timestamp(0)
  updated_at          DateTime?             @db.Timestamp(0)
  deleted_at          DateTime?             @db.Timestamp(0)
  assign_id           Int                   @default(0)
  ai_enabled          Boolean               @default(false)
  assign_enabled      Boolean               @default(true)
  class_name          String?               @db.Text
  account_type        accounts_account_type @default(TURNITIN)
  is_quick_submission Boolean               @default(false)
  external_sessions   external_sessions[]

  @@index([created_at], map: "accounts_created_at_index")
  @@index([status], map: "accounts_status")
  @@index([deleted_at], map: "accounts_deleted_at_index")
  @@index([email], map: "accounts_email_index")
  @@index([type, status], map: "accounts_type_status_index")
  @@index([account_type], map: "idx_accounts_account_type")
}

model users {
  id                                            BigInt                 @id @default(autoincrement()) @db.UnsignedBigInt
  name                                          String
  email                                         String?                @unique(map: "users_email_unique")
  email_verified_at                             DateTime?              @db.Timestamp(0)
  password                                      String
  membership_threshold                          Int?
  membership_length                             Int?
  membership_student_count                      Int?
  membership_started_at                         DateTime?              @db.Timestamp(0)
  membership_ended_at                           DateTime?              @db.Timestamp(0)
  instructor_id                                 BigInt?                @db.UnsignedBigInt
  active                                        Boolean                @default(false)
  remember_token                                String?                @db.VarChar(100)
  created_at                                    DateTime?              @db.Timestamp(0)
  updated_at                                    DateTime?              @db.Timestamp(0)
  deleted_at                                    DateTime?              @db.Timestamp(0)
  email_previous                                String?
  ai_enabled                                    Boolean                @default(false)
  session_id                                    String?
  membership_histories                          membership_histories[]
  submissions_submissions_assigned_to_idTousers submissions[]          @relation("submissions_assigned_to_idTousers")
  submissions_submissions_user_idTousers        submissions[]          @relation("submissions_user_idTousers")
  users                                         users?                 @relation("usersTousers", fields: [instructor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "users_instructor_id_foreign")
  other_users                                   users[]                @relation("usersTousers")

  @@index([active], map: "users_active")
  @@index([name], map: "users_name_index")
  @@index([deleted_at], map: "users_deleted_at_index")
  @@index([instructor_id], map: "users_instructor_id_foreign")
}

model activity_log {
  id           BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  log_name     String?
  description  String    @db.Text
  subject_type String?
  event        String?
  subject_id   BigInt?   @db.UnsignedBigInt
  causer_type  String?
  causer_id    BigInt?   @db.UnsignedBigInt
  properties   String?   @db.LongText
  batch_uuid   String?   @db.Char(36)
  created_at   DateTime? @db.Timestamp(0)
  updated_at   DateTime? @db.Timestamp(0)

  @@index([log_name], map: "activity_log_log_name_index")
  @@index([causer_type, causer_id], map: "causer")
  @@index([subject_type, subject_id], map: "subject")
}

model external_sessions {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  reference  String
  expire_at  DateTime  @default(now()) @db.Timestamp(0)
  account_id BigInt    @db.UnsignedBigInt
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  deleted_at DateTime? @db.Timestamp(0)
  accounts   accounts  @relation(fields: [account_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "sessions_account_id_foreign")

  @@index([account_id], map: "sessions_account_id_foreign")
  @@index([deleted_at], map: "sessions_deleted_at_index")
  @@index([expire_at], map: "sessions_expire_at")
  @@index([reference], map: "sessions_reference")
  @@index([created_at], map: "external_sessions_created_at_index")
}

model failed_jobs {
  id         BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  uuid       String   @unique(map: "failed_jobs_uuid_unique")
  connection String   @db.Text
  queue      String   @db.Text
  payload    String   @db.LongText
  exception  String   @db.LongText
  failed_at  DateTime @default(now()) @db.Timestamp(0)
}

model membership_histories {
  id            BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  threshold     Int       @default(0)
  length        Int       @default(0)
  student_count Int       @default(0)
  value         Int       @default(0)
  started_at    DateTime? @db.Timestamp(0)
  ended_at      DateTime? @db.Timestamp(0)
  user_id       BigInt    @db.UnsignedBigInt
  created_at    DateTime? @db.Timestamp(0)
  updated_at    DateTime? @db.Timestamp(0)
  deleted_at    DateTime? @db.Timestamp(0)
  users         users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "membership_histories_user_id_foreign")

  @@index([deleted_at], map: "membership_histories_deleted_at_index")
  @@index([user_id], map: "membership_histories_user_id_foreign")
}

model migrations {
  id        Int    @id @default(autoincrement()) @db.UnsignedInt
  migration String
  batch     Int
}

model model_has_permissions {
  permission_id BigInt      @db.UnsignedBigInt
  model_type    String
  model_id      BigInt      @db.UnsignedBigInt
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "model_has_permissions_permission_id_foreign")

  @@id([permission_id, model_id, model_type])
  @@index([model_id, model_type], map: "model_has_permissions_model_id_model_type_index")
}

model model_has_roles {
  role_id    BigInt @db.UnsignedBigInt
  model_type String
  model_id   BigInt @db.UnsignedBigInt
  roles      roles  @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "model_has_roles_role_id_foreign")

  @@id([role_id, model_id, model_type])
  @@index([model_id, model_type], map: "model_has_roles_model_id_model_type_index")
}

model notifications {
  id              String    @id @db.Char(36)
  type            String
  notifiable_type String
  notifiable_id   BigInt    @db.UnsignedBigInt
  data            String    @db.Text
  read_at         DateTime? @db.Timestamp(0)
  created_at      DateTime? @db.Timestamp(0)
  updated_at      DateTime? @db.Timestamp(0)

  @@index([notifiable_type, notifiable_id], map: "notifications_notifiable_type_notifiable_id_index")
}

model password_reset_tokens {
  email      String    @id
  token      String
  created_at DateTime? @db.Timestamp(0)
}

model permissions {
  id                    BigInt                  @id @default(autoincrement()) @db.UnsignedBigInt
  name                  String
  class                 String
  guard_name            String
  created_at            DateTime?               @db.Timestamp(0)
  updated_at            DateTime?               @db.Timestamp(0)
  model_has_permissions model_has_permissions[]
  role_has_permissions  role_has_permissions[]

  @@unique([name, guard_name], map: "permissions_name_guard_name_unique")
}

model personal_access_tokens {
  id             BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  tokenable_type String
  tokenable_id   BigInt    @db.UnsignedBigInt
  name           String
  token          String    @unique(map: "personal_access_tokens_token_unique") @db.VarChar(64)
  abilities      String?   @db.Text
  last_used_at   DateTime? @db.Timestamp(0)
  expires_at     DateTime? @db.Timestamp(0)
  created_at     DateTime? @db.Timestamp(0)
  updated_at     DateTime? @db.Timestamp(0)

  @@index([tokenable_type, tokenable_id], map: "personal_access_tokens_tokenable_type_tokenable_id_index")
}

model role_has_permissions {
  permission_id BigInt      @db.UnsignedBigInt
  role_id       BigInt      @db.UnsignedBigInt
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "role_has_permissions_permission_id_foreign")
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "role_has_permissions_role_id_foreign")

  @@id([permission_id, role_id])
  @@index([role_id], map: "role_has_permissions_role_id_foreign")
}

model roles {
  id                   BigInt                 @id @default(autoincrement()) @db.UnsignedBigInt
  name                 String
  guard_name           String
  created_at           DateTime?              @db.Timestamp(0)
  updated_at           DateTime?              @db.Timestamp(0)
  model_has_roles      model_has_roles[]
  role_has_permissions role_has_permissions[]

  @@unique([name, guard_name], map: "roles_name_guard_name_unique")
}

model settings {
  id                     BigInt                @id @default(autoincrement()) @db.UnsignedBigInt
  usage_daily_instructor Int                   @default(100)
  usage_daily_student    Int                   @default(15)
  created_at             DateTime?             @db.Timestamp(0)
  updated_at             DateTime?             @db.Timestamp(0)
  submission_action      String                @default("AUTO")
  email_to_list          String?
  account_type           settings_account_type @default(TURNITIN)

  @@index([account_type], map: "idx_settings_account_type")
}

model submissions {
  id                                      BigInt             @id @default(autoincrement()) @db.UnsignedBigInt
  title                                   String
  status                                  submissions_status
  file_link                               String
  report_link                             String?
  similarity                              Int?
  exclusion_bibliographic                 Boolean            @default(false)
  exclusion_quoted                        Boolean            @default(false)
  exclusion_small_sources                 Boolean            @default(false)
  exclusion_type                          String             @default("none")
  exclusion_value                         Int                @default(0)
  source                                  submissions_source @default(API)
  posted_at                               DateTime?          @db.Timestamp(0)
  issued_at                               DateTime?          @db.Timestamp(0)
  user_id                                 BigInt             @db.UnsignedBigInt
  created_at                              DateTime?          @db.Timestamp(0)
  updated_at                              DateTime?          @db.Timestamp(0)
  deleted_at                              DateTime?          @db.Timestamp(0)
  ai_similarity                           Int                @default(-1)
  ai_error_message                        String?            @db.Text
  ai_state                                String             @default("IGNORED")
  ai_link                                 String?
  original_filename                       String?
  error_message                           String?
  admin_error_message                     String?
  assigned_to_id                          BigInt?            @db.UnsignedBigInt
  page_count                              Int                @default(0)
  word_count                              Int                @default(0)
  char_count                              Int                @default(0)
  is_quick_submission                     Boolean            @default(false)
  users_submissions_assigned_to_idTousers users?             @relation("submissions_assigned_to_idTousers", fields: [assigned_to_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "submissions_assigned_to_id_foreign")
  users_submissions_user_idTousers        users              @relation("submissions_user_idTousers", fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "submissions_user_id_foreign")

  @@index([assigned_to_id], map: "submissions_assigned_to_id_foreign")
  @@index([created_at], map: "submissions_created_at_index")
  @@index([deleted_at], map: "submissions_deleted_at_index")
  @@index([posted_at], map: "submissions_posted_at_index")
  @@index([status], map: "submissions_status")
  @@index([title], map: "submissions_title_index")
  @@index([user_id], map: "submissions_user_id_foreign")
}

model sessions {
  id            String  @id
  user_id       BigInt? @db.UnsignedBigInt
  ip_address    String? @db.VarChar(45)
  user_agent    String? @db.Text
  payload       String  @db.LongText
  last_activity Int

  @@index([last_activity], map: "sessions_last_activity_index")
  @@index([user_id], map: "sessions_user_id_index")
}

enum accounts_status {
  SUSPENDED
  ACTIVE
}

enum submissions_status {
  PENDING
  PROCESSING
  COMPLETED
  IGNORED
  DELETED
}

enum accounts_type {
  INSTRUCTOR
  STUDENT
}

enum submissions_source {
  API
  WEB
}

enum settings_account_type {
  TURNITIN
  TURNDETECT
}

enum accounts_account_type {
  TURNITIN
  TURNDETECT
}
